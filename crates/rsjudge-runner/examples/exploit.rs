// SPDX-License-Identifier: Apache-2.0

use capctl::CapState;
use nix::unistd::{setuid, Uid};

/// This example should be called by the `exploit` example.
///
/// It tries to call `setuid(0)`.
///
/// To ensure the test is working, the compiled binary should
/// have no permitted capabilities.
fn main() {
    eprintln!("Start exploit_inner binary");
    dbg!(CapState::get_current().unwrap());

    eprintln!("Starting setuid syscall.");
    let result = setuid(Uid::from_raw(0)).expect_err("Should fail to set UID");
    dbg!(result.desc());
    eprintln!("Failed calling setuid, test pass.");
    eprintln!("End exploit_inner binary");
}
