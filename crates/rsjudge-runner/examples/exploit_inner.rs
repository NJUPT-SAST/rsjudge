use caps::{read, CapSet};
use nix::unistd::{setuid, Uid};

/// This example should be called by the `exploit` example.
///
/// It tries to call `setuid(0)`.
///
/// To ensure the test is working, the compiled binary should
/// have no permitted capabilities.
fn main() {
    eprintln!("Start exploit_inner binary");
    dbg!(read(None, CapSet::Ambient).unwrap());
    dbg!(read(None, CapSet::Effective).unwrap());
    dbg!(read(None, CapSet::Inheritable).unwrap());
    dbg!(read(None, CapSet::Permitted).unwrap());

    eprintln!("Starting setuid syscall.");
    let result = setuid(Uid::from_raw(0)).expect_err("Should fail to set UID");
    dbg!(result.desc());
    eprintln!("Failed calling setuid, test pass.");
    eprintln!("End exploit_inner binary");
}
