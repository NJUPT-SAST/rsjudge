= rsjudge
:lang: zh-CN
:toc: preamble
:toc-title: ç›®å½•

image:assets/rsjudge.svg[Rsjudge logo]

xref:README.adoc[English]

ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„åœ¨çº¿è¯„æµ‹æ²™ç®±æœåŠ¡å™¨ï¼Œå—åˆ° https://github.com/criyle/go-judge[go-judge] çš„å¯å‘ï¼ŒæœåŠ¡äº SASTOJã€‚

== ç‰¹æ€§

* æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è½»æ¾æ·»åŠ æ–°çš„è¯­è¨€ã€‚
* æ”¯æŒå¤šä¸ªç¼–è¯‘å™¨ç‰ˆæœ¬â€”â€”åªéœ€ä½¿ç”¨ä½ å–œæ¬¢çš„å·¥å…·é“¾ç®¡ç†å™¨å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è·¯å¾„ã€‚
* æ”¯æŒè‡ªæˆ‘æµ‹è¯•å’Œæœ€ç»ˆæäº¤ã€‚
* é€šè¿‡ TOML é…ç½®æ–‡ä»¶ï¼Œè½»æ¾è‡ªå®šä¹‰ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹ã€‚
* å¯ä»¥ç›‘æ§å’Œé™åˆ¶èµ„æºä½¿ç”¨ã€‚
* ä¸ SASTOJ è‰¯å¥½å…¼å®¹ã€‚
* æ”¯æŒ RESTful APIã€gRPC å’Œ RabbitMQï¼Œå¯é€šè¿‡ feature flag æˆ–é…ç½®æ–‡ä»¶å¯ç”¨æˆ–ç¦ç”¨ã€‚
* é‡‡ç”¨ SSE æˆ– gRPC æµå®æ—¶æµå¼è¿”å›è¯„æµ‹ç»“æœã€‚
* æ”¯æŒä½¿ç”¨æ’ä»¶è¿›è¡Œæ‰©å±•ã€‚
* ä½¿ç”¨ RustğŸ¦€ç¼–å†™ï¼Œé€Ÿåº¦æå¿«ï¼Œå®‰å…¨æ€§é«˜ã€‚

== å‘éŸ³å’Œæ‹¼å†™

"rsjudge" æ˜¯ "Rust" å’Œ "judge" çš„ç»„åˆï¼Œå‘éŸ³ä¸º "R-S-judge"ã€‚å•è¯åº”è¯¥ä»¥å°å†™å­—æ¯ä¹¦å†™ï¼Œå•è¯ä¸­é—´æ— ç©ºæ ¼ï¼Œå³ä½¿åœ¨æ ‡é¢˜æˆ–å¥å­å¼€å¤´ä¹Ÿæ˜¯å¦‚æ­¤ã€‚

== ç›®å½•ç»“æ„

`src/`::
    å…¥å£ç‚¹çš„æºä»£ç ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œæ¥å£å’Œé…ç½®è§£æã€‚
`xtask/`::
    ç”¨äºæ„å»ºå’Œæ‰“åŒ…çš„é¢å¤–ä»»åŠ¡ï¼Œä½¿ç”¨ `cargo xtask <TASK>` è°ƒç”¨ã€‚
`crates/`::
    é¡¹ç›®çš„å­ crateã€‚
    `crates/rsjudge-grpc/`:::
        gRPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚
    `crates/rsjudge-judger/`:::
        ç­”æ¡ˆæ¯”è¾ƒå’Œè¯„åˆ¤ã€‚
    `crates/rsjudge-rest/`:::
        RESTful API æœåŠ¡å™¨ã€‚
    `crates/rsjudge-runner/`:::
        æ‰§è¡Œå„ç§å‘½ä»¤çš„æ²™ç®±ï¼Œæä¾›ç”¨æˆ·åˆ‡æ¢ã€I/O é‡å®šå‘ã€å®‰å…¨ä¸Šä¸‹æ–‡ç­‰åŠŸèƒ½ã€‚
`packaging/`::
    ç”¨äºç”Ÿæˆ `.deb` ä¸ `.rpm` åŒ…çš„é™„åŠ æ–‡ä»¶ã€‚

https://mango-dune-07a8b7110.1.azurestaticapps.net/?repo=NJUPT-SAST%2Frsjudge[
    image:https://github.com/NJUPT-SAST/rsjudge/raw/diagram/diagram.svg[
        ç›®å½•ç»“æ„å¯è§†åŒ–
    ]
]

== ä»æºä»£ç æ„å»º

=== å…ˆå†³æ¡ä»¶

* ç¬¦åˆ <<msrv, MSRV>> çš„ Rust å·¥å…·é“¾ã€‚
* Linux å†…æ ¸ >= 4.5
** è¿™æ˜¯ä¸ºäº†æ”¯æŒ Seccomp BPFã€‚
* å¯¹äº gRPC æ”¯æŒï¼ˆåœ¨ `grpc` ç‰¹æ€§ä¸‹ï¼‰
** https://github.com/protocolbuffers/protobuf?tab=readme-ov-file#protobuf-compiler-installation[`protoc`] >= 3.15,
** https://github.com/bufbuild/buf/[`buf`] ç”¨äº gRPC ä¾èµ–ç®¡ç†ã€‚
* å¯¹äº `.deb` åŒ…çš„ç”Ÿæˆï¼Œéœ€è¦å®‰è£…äº† `dpkg-dev` å’Œ `liblzma-dev` çš„ Debian/Ubuntu ç³»ç»Ÿã€‚

[#msrv]
==== MSRVï¼ˆæœ€ä½æ”¯æŒçš„ Rust ç‰ˆæœ¬ï¼‰

rsjudge é‡‡å– N - 2 çš„ MSRV ç­–ç•¥ï¼Œå…¶ä¸­ N æ˜¯å½“å‰çš„ Rust ç¨³å®šç‰ˆæœ¬ã€‚ä¾‹å¦‚ï¼Œå¦‚æœå½“å‰çš„ Rust ç¨³å®šç‰ˆæœ¬æ˜¯ 1.79ï¼Œåˆ™ MSRV å°†ä¼šè¢«è®¾ç½®ä¸º 1.77ã€‚

å½“å‰çš„ MSRV å¯ä»¥ä» link:Cargo.toml[] ä¸­çš„ `rust-version` å­—æ®µä¸­æ‰¾åˆ°ã€‚åœ¨æ›´æ–° MSRV åï¼Œæˆ‘ä»¬å°†ä¸å†æ”¯æŒä»»ä½•æ¯”å…¶æ›´æ—§çš„ Rust ç‰ˆæœ¬ã€‚è¿™äº›ç‰ˆæœ¬å¯èƒ½ä»ç„¶å¯ä»¥å·¥ä½œï¼Œæˆ–è€…æ— æ³•æ­£ç¡®ç¼–è¯‘æˆ–è¿è¡Œ rsjudgeã€‚

=== å®‰è£…é¢å¤–çš„ä¾èµ–

==== Debian/Ubuntu

. ç¡®ä¿ `PATH` ä¸­åŒ…å« `protoc` >= 3.15ï¼Œå¯ä»¥ä»
https://github.com/protocolbuffers/protobuf/releases/[å‘å¸ƒé¡µ]ä¸‹è½½æœ€æ–°ç‰ˆæœ¬ã€‚

** åœ¨ Debian 12, Ubuntu 23.04 æˆ–æ›´é«˜ç‰ˆæœ¬çš„ç³»ç»Ÿä¸Šï¼Œå¯ä»¥ä½¿ç”¨ `apt` å®‰è£…ç¬¦åˆç‰ˆæœ¬è¦æ±‚çš„ `protoc`ï¼š
+
[,bash]
----
sudo apt install -y protobuf-compiler libprotobuf-dev
protoc --version
# libprotoc <VERSION>
----

. æ‰‹åŠ¨å®‰è£… `buf`ã€‚

. ä½¿ç”¨ `apt` å®‰è£…æ‰“åŒ… `.deb` éœ€è¦çš„è½¯ä»¶åŒ…ï¼š
+
[,bash]
----
sudo apt install -y dpkg-dev liblzma-dev
----

==== Alpine

[,bash]
----
sudo apk add lld protoc protobuf-dev

# å®‰è£… `buf` å·¥å…·
curl -sSL -o buf \
  "https://github.com/bufbuild/buf/releases/download/latest/buf-Linux-$(uname -m)"
# æ‚¨å¯ä»¥ç”¨è‡ªå·±å–œæ¬¢çš„ç›®å½•æ›¿æ¢ `/usr/local/bin`ï¼Œå¹¶ç¡®ä¿å°†å…¶æ·»åŠ åˆ° `PATH` ä¸­ã€‚
sudo install -Dm755 buf /usr/local/bin/buf
----

==== Arch Linux

[,bash]
----
sudo pacman -S --needed lld protobuf buf
----

=== æ„å»º

å…‹éš†ä»“åº“ï¼š

[,bash]
----
git clone https://github.com/NJUPT-SAST/rsjudge.git
cd rsjudge
----

ä½¿ç”¨ Cargo æ„å»ºé¡¹ç›®ï¼š

[,bash]
----
cargo build --release
----

ç”Ÿæˆ `.deb` åŒ…ï¼š

[,bash]
----
cargo xtask dist deb
----

ç”Ÿæˆçš„è½¯ä»¶åŒ…ä½äº `target/debian` ç›®å½•ä¸‹ã€‚
