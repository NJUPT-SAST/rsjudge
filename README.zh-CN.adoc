= RsJudge
:toc: preamble
:toc-title: ç›®å½•

ä¸€ä¸ªç”¨ Rust ç¼–å†™çš„åœ¨çº¿è¯„æµ‹æ²™ç®±æœåŠ¡å™¨ï¼Œå—åˆ° https://github.com/criyle/go-judge[go-judge] çš„å¯å‘ï¼Œç”¨äº SAST OJã€‚

== ç‰¹æ€§

* æ”¯æŒå¤šç§ç¼–ç¨‹è¯­è¨€ï¼Œå¯ä»¥åœ¨é…ç½®æ–‡ä»¶ä¸­è½»æ¾æ·»åŠ æ–°çš„è¯­è¨€ã€‚
* æ”¯æŒå¤šä¸ªç¼–è¯‘å™¨ç‰ˆæœ¬â€”â€”åªéœ€ä½¿ç”¨ä½ å–œæ¬¢çš„å·¥å…·é“¾ç®¡ç†å™¨å¹¶åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®è·¯å¾„ã€‚
* æ”¯æŒè‡ªæˆ‘æµ‹è¯•å’Œæœ€ç»ˆæäº¤ã€‚
* å¯ä»¥é€šè¿‡ TOML é…ç½®æ–‡ä»¶è‡ªå®šä¹‰ç¼–è¯‘å’Œæ‰§è¡Œè¿‡ç¨‹
* å¯ä»¥ç›‘æ§å’Œé™åˆ¶èµ„æºä½¿ç”¨
* å¼‚æ­¥æŠ¥å‘Šæµ‹è¯•ç»“æœ
* ä¸ SAST OJ è‰¯å¥½å…¼å®¹
* æ”¯æŒ RESTful API å’Œ gRPCï¼Œå¯é€šè¿‡ feature flag å’Œé…ç½®æ–‡ä»¶å¯ç”¨æˆ–ç¦ç”¨
* æ”¯æŒä½¿ç”¨æ’ä»¶è¿›è¡Œæ‰©å±•
* ä½¿ç”¨ RustğŸ¦€ç¼–å†™ï¼Œé€Ÿåº¦æå¿«ï¼Œå®‰å…¨æ€§é«˜

== ç›®å½•ç»“æ„

`src/`::
    å…¥å£ç‚¹çš„æºä»£ç ï¼ŒåŒ…æ‹¬å‘½ä»¤è¡Œæ¥å£å’Œé…ç½®è§£æã€‚
`xtask/`::
    ç”¨äºæ„å»ºå’Œæ‰“åŒ…çš„é¢å¤–ä»»åŠ¡ï¼Œä½¿ç”¨ `cargo xtask <TASK>` è°ƒç”¨ã€‚
`crates/`::
    é¡¹ç›®çš„å­ crateã€‚
    `crates/rsjudge-grpc/`:::
        gRPC æœåŠ¡å™¨å’Œå®¢æˆ·ç«¯ã€‚
    `crates/rsjudge-judger/`:::
        ç­”æ¡ˆæ¯”è¾ƒå’Œè¯„åˆ¤ã€‚
    `crates/rsjudge-rest/`:::
        RESTful API æœåŠ¡å™¨ã€‚
    `crates/rsjudge-runner/`:::
        æ‰§è¡Œå„ç§å‘½ä»¤çš„æ²™ç®±ï¼Œæä¾›ç”¨æˆ·åˆ‡æ¢ã€I/O é‡å®šå‘ã€å®‰å…¨ä¸Šä¸‹æ–‡ç­‰åŠŸèƒ½ã€‚
`debian/`::
    ç”¨äºç”Ÿæˆ `.deb` åŒ…çš„é™„åŠ æ–‡ä»¶ã€‚

https://mango-dune-07a8b7110.1.azurestaticapps.net/?repo=NJUPT-SAST%2Frsjudge[
    image:https://github.com/NJUPT-SAST/rsjudge/raw/diagram/diagram.svg[
        ç›®å½•ç»“æ„å¯è§†åŒ–
    ]
]

== ä»æºä»£ç æ„å»º

=== å…ˆå†³æ¡ä»¶

* Rust 1.74 æˆ–æ›´é«˜ç‰ˆæœ¬ã€‚
* `lld` ç”¨äºæ›´å¿«çš„é“¾æ¥ã€‚
** ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–é“¾æ¥å™¨ï¼Œåªéœ€æ›´æ–° `.cargo/config.toml` æ–‡ä»¶ã€‚
* Linux å†…æ ¸ >= 4.5
** è¿™æ˜¯ä¸ºäº†æ”¯æŒ Seccomp BPFã€‚
* å¯¹äº gRPC æ”¯æŒï¼Œéœ€è¦ `protoc` åè®®ç¼“å†²åŒºç¼–è¯‘å™¨ï¼Œä»¥åŠåè®®ç¼“å†²åŒºèµ„æºæ–‡ä»¶ï¼ˆåœ¨ `grpc` ç‰¹æ€§ä¸‹ï¼‰
* å¯¹äº `.deb` åŒ…çš„ç”Ÿæˆï¼Œéœ€è¦å®‰è£…äº† `dpkg-dev` å’Œ `liblzma-dev` çš„ Debian/Ubuntu ç³»ç»Ÿã€‚

=== å®‰è£…é¢å¤–çš„ä¾èµ–

==== Debian/Ubuntu

[,bash]
----
sudo apt install -y lld protobuf-compiler libprotobuf-dev

# å¦‚æœä½ æƒ³æ„å»º `.deb` åŒ…
sudo apt install -y dpkg-dev liblzma-dev
----

==== Alpine

[,bash]
----
sudo apk add lld protoc protobuf-dev
----

==== Arch Linux

[,bash]
----
sudo pacman -S --needed lld protobuf
----

=== æ„å»º

å…‹éš†ä»“åº“ï¼š

[,bash]
----
git clone https://github.com/NJUPT-SAST/rsjudge.git
cd rsjudge
----

ä½¿ç”¨ Cargo æ„å»ºé¡¹ç›®ï¼š

[,bash]
----
cargo build --release
----

ç”Ÿæˆ `.deb` åŒ…ï¼š

[,bash]
----
cargo xtask dist deb
----
